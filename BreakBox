-- Параметры источника данныхCLASS_CODE  = "SPBFUT";  -- Класс бумагиSEC_CODE = "RIH7";  -- Код бумагиTIME_FRAME = INTERVAL_M1; -- Таймфрейм-- Параметры стратегииLotsLong   = 1;            -- Количество лотов для входа в лонгLotsShort   = 1;            -- Количество лотов для входа в шортTimeStart  = 0;   -- Время начала работы стратегииTimeFinish  = 0;   -- Время окончания работы стратегииMinutesBuild  = 100;   -- Количество минут построения коробкиMinutesTrade  = 80;   -- Количество минут поиска входаMinHight  = 300;   -- Минимальная высота коробкиTrailing  = 500;   -- Размер трейлинг-стопаStopLoss  = 500;   -- Размер стоп-лосса-- Остальные переменные скриптаDS = nil; -- источник данных (DataSource)-- Поиск в таблице lua--   TBL - таблица для поиска--  FUNC - функция сравнения с одним параметром, в который передается значение элемента таблицы. Должна возвращать true в случае совпадения--  Возвращает ключ и значение первого найденного результата (или nil/nil при неудаче)function table_find(tbl,func)    for key,value in pairs(tbl) do        if func(value) then            return key,value        end    endendfunction LoadFromFile(fileName)  local file = io.open(fileName, "r")  if file ~= nil then    value = file:read()    file:close()    if value ~= nil then      return value    end  end  return ""endfunction WriteInFile(fileName, text)  local file = io.open(fileName, "w+t")  if file ~= nil then    file:write(text)    file:close()  endendfunction AppendInFile(fileName, text)  local file = io.open(fileName, "a")  if file ~= nil then    file:write(text)    file:close()  endend-- функция подключения к источнику данных для замены function ConnectData() --res = CreateDataSource(CLASS_CODE, SEC_CODE, TIME_FRAME); local f = io.open(getScriptPath().."//data.txt","r");    if f ~= nil then -- Если файл существует, перебирает строки файла, считывает содержимое в соответствующие переменные  local Count = 0; -- Счетчик строк  for line in f:lines() do   Count = Count + 1;     end; end; return res;end;-- При инициализации скрипта подключаемся к графику выбранного таймфреймаfunction OnInit() -- Подключается к источнику данных (графику) DS = ConnectData(); -- Вычисляет время открытия следующего бара NextBarSeconds = os.time(DS:T(DS:Size())) + TIME_FRAME * 60; -- Закрывает источник данных DS:Close(); -- открываем файл для записи сделок в режиме "чтения/записи" local f = io.open(getScriptPath().."//deals.txt","r+");end;function main() -- Функция, реализующая основной поток выполнения в скрипте while IsRun do -- Цикл будет выполнятся, пока IsRun == true   end;end;
